"use strict";var A,e=require("itty-router"),t=require("@asteasolutions/zod-to-openapi"),r=require("zod");class n extends Error{key;constructor(A){super(A),this.message=A}}function s(A){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1"/>\n    <meta name="description" content="SwaggerIU"/>\n    <title>SwaggerUI</title>\n    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui.css"/>\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n</head>\n<body>\n<div id="swagger-ui"></div>\n<script src="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui-bundle.js" crossorigin><\/script>\n<script src="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui-standalone-preset.js" crossorigin><\/script>\n<script>\n    window.onload = () => {\n        window.ui = SwaggerUIBundle({\n            url: '${A=A.replace(/\/+(\/|$)/g,"$1")}',\n            dom_id: '#swagger-ui',\n            deepLinking: true,\n            presets: [\n                SwaggerUIBundle.presets.apis\n            ]\n        });\n    };\n<\/script>\n</body>\n</html>`}function o(A){return`<!DOCTYPE html>\n    <html>\n    <head>\n    <title>ReDocUI</title>\n    \x3c!-- needed for adaptive design --\x3e\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n\n    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n\n    \x3c!--\n    ReDoc doesn't change outer page styles\n    --\x3e\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n      }\n    </style>\n    </head>\n    <body>\n    <redoc spec-url="${A=A.replace(/\/+(\/|$)/g,"$1")}"></redoc>\n    <script src="https://unpkg.com/redoc@2.0.0-rc.58/bundles/redoc.standalone.js"> <\/script>\n    </body>\n    </html>`}exports.SchemaVersion=void 0,(exports.SchemaVersion||(exports.SchemaVersion={})).V1="v1",exports.AuthType=void 0,(A=exports.AuthType||(exports.AuthType={})).NONE="none",A.OAUTH="oauth",A.SERVICE_HTTP="service_http",A.USER_HTTP="user_http",exports.APIType=void 0,(exports.APIType||(exports.APIType={})).OPENAPI="openapi";class a extends t.OpenAPIRegistry{_definitions=[];merge(A){for(const e of A._definitions)this._definitions.push({...e})}}function i(A){return void 0!==A._def}function c(A,e){return"ZodArray"===A._def.typeName||"ZodArray"===A._def.innerType?._def.typeName||"ZodArray"===A._def.schema?._def.innerType?._def.typeName}function p(A,e){if(e=e||{},null===A)return new h({required:!1,...e});if(i(A))return e?u(A,e):A;if(!0===A.generator)return new A(e);if(A===String)return new h(e);if("string"==typeof A)return new h({example:A});if(A===Number)return new f(e);if("number"==typeof A)return new f({example:A});if(A===Boolean)return new g(e);if("boolean"==typeof A)return new g({example:A});if(A===Date)return new m(e);if(Array.isArray(A)){if(0===A.length)throw new Error("Arr must have a type");return new l(A[0],e)}if("object"==typeof A)return new d(A,e);throw new Error(`${A} not implemented`)}function u(A,e){return!1===(e=e||{}).required&&(A=A.optional()),e.description&&(A=A.describe(e.description)),e.default&&(A=A.default(e.default)),e.example&&(A=A.openapi({example:e.example})),A}void 0===r.z.string().openapi&&t.extendZodWithOpenApi(r.z);class l{static generator=!0;constructor(A,e){return u(p(A).array(),e)}}class d{static generator=!0;constructor(A,e){const t={};for(const[e,r]of Object.entries(A))t[e]=p(r);return u(r.z.object(t),e)}}class f{static generator=!0;constructor(A){return u(r.z.number().or(r.z.string()).pipe(r.z.coerce.number()),A).openapi({type:"number"})}}class h{static generator=!0;constructor(A){return u(r.z.string(),A)}}class m{static generator=!0;constructor(A){return u(r.z.string().datetime({message:"Must be in the following format: YYYY-mm-ddTHH:MM:ssZ"}),A)}}class g{static generator=!0;constructor(A){return u(r.z.coerce.string().toLowerCase().pipe(r.z.enum(["true","false"]).transform((A=>"true"===A))),A).openapi({type:"boolean"})}}function y(A,e){const{searchParams:t}=new URL(A.url);if(0===t.size)return null;const r={};for(const[A,n]of t.entries())void 0===r[A]?r[A]=n:Array.isArray(r[A])?r[A].push(n):r[A]=[r[A],n],e&&e.shape[A]&&(c(e.shape[A])&&!Array.isArray(r[A])?r[A]=[r[A]]:c(e.shape[A]));return r}function w(A,e){return new Response(JSON.stringify(A),{headers:{"content-type":"application/json;charset=UTF-8"},status:e?.status?e.status:200,...e})}exports.ApiException=n,exports.Arr=l,exports.Bool=g,exports.DateOnly=class{static generator=!0;constructor(A){return u(r.z.coerce.date(),A)}},exports.DateTime=m,exports.Email=class{static generator=!0;constructor(A){return u(r.z.string().email(),A)}},exports.Enumeration=class{static generator=!0;constructor(A){let{values:e}=A;const t={...e};Array.isArray(e)&&(e=Object.fromEntries(e.map((A=>[A,A]))));const n=Object.keys(e);!1===A.enumCaseSensitive&&(e=Object.keys(e).reduce(((A,t)=>(A[t.toLowerCase()]=e[t],A)),{}));const s=Object.keys(e);let o;o=[void 0,!0].includes(A.enumCaseSensitive)?r.z.enum(s):r.z.preprocess((A=>String(A).toLowerCase()),r.z.enum(s)).openapi({enum:n}),o=o.transform((A=>e[A]));const a=u(o,A);return a.values=t,a}},exports.Header=function(A,e={}){return{name:e.name,location:"header",type:p(A,e)}},exports.Hostname=class{static generator=!0;constructor(A){return u(r.z.string().regex(/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/),A)}},exports.InputValidationException=class extends n{constructor(A){super(A)}},exports.Int=class{static generator=!0;constructor(A){return u(r.z.number().int().or(r.z.string()).pipe(r.z.coerce.number()),A).openapi({type:"integer"})}},exports.Ipv4=class{static generator=!0;constructor(A){return u(r.z.coerce.string().ip({version:"v4"}),A)}},exports.Ipv6=class{static generator=!0;constructor(A){return u(r.z.string().ip({version:"v6"}),A)}},exports.Num=f,exports.Obj=d,exports.OpenAPIRoute=class{handle(A,...e){throw new Error("Method not implemented.")}static isRoute=!0;static schema;params;constructor(A){this.params=A}static getSchema(){return this.schema}schema(){return this.__proto__.constructor.schema}getSchema(){return this.__proto__.constructor.getSchema()}getSchemaZod(){return this.__proto__.constructor.getSchemaZod()}static getSchemaZod(){const A={...this.getSchema()};let e={},t=A.requestBody;const n={},s={};t&&t.$customRequestBody?s.requestBody=t.content:t&&(i(t)||(t=p(t)),t={content:{"application/json":{schema:t}}},e.body=t),A.responses||(A.responses={200:{description:"Successfull response",schema:{}}});for(const[e,t]of Object.entries(A.responses)){let A=t.schema||{};i(A)||(A=p(A));const r=t.contentType||"application/json";n[e]={description:t.description,content:{[r]:{schema:A}}}}if(A.parameters){let t=A.parameters;const n={};Array.isArray(t)&&(t=t.reduce(((A,e)=>Object.assign(A,{[e.name]:e})),{}));for(const[A,e]of Object.entries(t))n[e.location]||(n[e.location]={}),n[e.location][A]=e.type;for(const[A,e]of Object.entries(n))n[A]=r.z.object(e);e={...e,...n}}return delete A.requestBody,delete A.parameters,delete A.responses,{...A,request:{...e},responses:n,...s}}handleValidationError(A){return w({errors:A,success:!1,result:{}},{status:400})}async execute(...A){const{data:e,errors:t}=await this.validateRequest(A[0]);if(t)return this.handleValidationError(t);A.push(e);const r=await this.handle(...A);return r instanceof Response||"object"!=typeof r?r:w(r)}extractQueryParameters(A,e){return y(A,e)}async validateRequest(A){const e=this.__proto__.constructor.getSchemaZod(),t={},n={};e.request?.params&&(n.params=e.request?.params,t.params=A.params),e.request?.query&&(n.query=e.request?.query,t.query={}),e.request?.headers&&(n.headers=e.request?.headers,t.headers={});const s=this.extractQueryParameters(A,e.request?.query);if(s&&(t.query=s),e.request?.headers){t.headers={};for(const r of Object.keys(e.request?.headers.shape))t.headers[r]=A.headers.get(r)}if("get"!==A.method.toLowerCase()&&e.request?.body&&e.request?.body.content["application/json"]&&e.request?.body.content["application/json"].schema){n.body=e.request.body.content["application/json"].schema;try{t.body=await A.json()}catch(A){t.body={}}}let o=r.z.object(n);void 0!==this.params?.raiseUnknownParameters&&!0!==this.params?.raiseUnknownParameters||(o=o.strict());const a=o.safeParse(t);return{data:a.success?a.data:void 0,errors:a.success?void 0:a.error.issues}}},exports.OpenAPIRouter=function(A){const n=new a,i=()=>{let e=t.OpenApiGeneratorV31;"3"===A?.openapiVersion&&(e=t.OpenApiGeneratorV3);return new e(n.definitions).generateDocument({openapi:"3"===A?.openapiVersion?"3.0.3":"3.1.0",info:{version:A?.schema?.info?.version||"1.0.0",title:A?.schema?.info?.title||"OpenAPI",...A?.schema?.info},...A?.schema})},c=e.Router({base:A?.base,routes:A?.routes}),p=new Proxy(c,{get:(e,t,s,o)=>"original"===t?c:"schema"===t?i():"registry"===t?n:(o,...a)=>{if("handle"!==t)if(1===a.length&&a[0].registry){const A=a[0];n.merge(A.registry)}else if("all"!==t){const e=(A?.base||"")+o.replace(/\/+(\/|$)/g,"$1").replace(/:(\w+)/g,"{$1}");let s,i;for(const A of a)if(A.name&&(i=`${t.toString()}_${A.name}`),A.getSchemaZod){s=A.getSchemaZod();break}if(void 0===i&&(i=`${t.toString()}_${o.replaceAll("/","_")}`),void 0===s){s={operationId:i,responses:{200:{description:"Object with user data."}}};const A=o.match(/:(\w+)/g);A&&(s.request={params:r.z.object(A.reduce(((A,e)=>Object.assign(A,{[e]:r.z.string()})),{}))})}else if(!s.operationId){if(!1===A?.generateOperationIds&&!s.operationId)throw new Error(`Route ${o} don't have operationId set!`);s.operationId=i}n.registerPath({...s,method:t.toString(),path:e})}return Reflect.get(e,t,s)(o,...a.map((A=>A.handle?A.handle:A.isRoute?(...e)=>new A({}).execute(...e):A)))}});return null!==A?.docs_url&&null!==A?.openapi_url&&c.get(A?.docs_url||"/docs",(()=>new Response(s((A?.base||"")+(A?.openapi_url||"/openapi.json")),{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==A?.redoc_url&&null!==A?.openapi_url&&c.get(A?.redoc_url||"/redocs",(()=>new Response(o((A?.base||"")+(A?.openapi_url||"/openapi.json")),{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==A?.openapi_url&&c.get(A?.openapi_url||"/openapi.json",(()=>new Response(JSON.stringify(i()),{headers:{"content-type":"application/json;charset=UTF-8"},status:200}))),A?.aiPlugin&&null!==A?.openapi_url&&c.get("/.well-known/ai-plugin.json",(e=>{const t={type:exports.APIType.OPENAPI,has_user_authentication:!1,url:A?.openapi_url||"/openapi.json",...A?.aiPlugin?.api};return t.url.startsWith("http")||(t.url=`https://${e.headers.get("host")}${t.url}`),new Response(JSON.stringify({schema_version:exports.SchemaVersion.V1,auth:{type:exports.AuthType.NONE},...A?.aiPlugin,api:t}),{headers:{"content-type":"application/json;charset=UTF-8"},status:200})})),p},exports.Path=function(A,e={}){return{name:e.name,location:"params",type:p(A,e)}},exports.Query=function(A,e={}){return{name:e.name,location:"query",type:p(A,e)}},exports.Regex=class{static generator=!0;constructor(A){return u(r.z.string().regex(A.pattern),A)}},exports.RequestBody=class{$customRequestBody=!0;content;constructor(A){this.content=A}},exports.Str=h,exports.Uuid=class{static generator=!0;constructor(A){return u(r.z.string().uuid(),A)}},exports.ValidationError=class extends n{constructor(A){super(A)}},exports.convertParams=u,exports.extractParameter=function(A,e,t,r){if("query"===r)return e[t];if("path"===r)return A.params[t];if("header"===r)return A.headers.get(t);if("cookie"===r)throw new Error("Cookie parameters not implemented yet")},exports.extractQueryParameters=y,exports.getReDocUI=o,exports.getSwaggerUI=s,exports.jsonResp=w;
