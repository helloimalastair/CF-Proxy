import{Router as A}from"itty-router";import{OpenAPIRegistry as e,OpenApiGeneratorV31 as t,OpenApiGeneratorV3 as r,extendZodWithOpenApi as n}from"@asteasolutions/zod-to-openapi";import{z as s}from"zod";class o extends Error{key;constructor(A){super(A),this.message=A}}class a extends o{constructor(A){super(A)}}class i extends o{constructor(A){super(A)}}function c(A){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1"/>\n    <meta name="description" content="SwaggerIU"/>\n    <title>SwaggerUI</title>\n    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui.css"/>\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n</head>\n<body>\n<div id="swagger-ui"></div>\n<script src="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui-bundle.js" crossorigin><\/script>\n<script src="https://unpkg.com/swagger-ui-dist@5.1.3/swagger-ui-standalone-preset.js" crossorigin><\/script>\n<script>\n    window.onload = () => {\n        window.ui = SwaggerUIBundle({\n            url: '${A=A.replace(/\/+(\/|$)/g,"$1")}',\n            dom_id: '#swagger-ui',\n            deepLinking: true,\n            presets: [\n                SwaggerUIBundle.presets.apis\n            ]\n        });\n    };\n<\/script>\n</body>\n</html>`}function u(A){return`<!DOCTYPE html>\n    <html>\n    <head>\n    <title>ReDocUI</title>\n    \x3c!-- needed for adaptive design --\x3e\n    <meta charset="utf-8"/>\n    <meta name="viewport" content="width=device-width, initial-scale=1">\n\n    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:300,400,700" rel="stylesheet">\n    <link rel="shortcut icon" href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlMb//2ux//9or///ZKz//wlv5f8JcOf/CnXv/why7/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB2vi/wZo3/9ytf//b7P//2uw//+BvP//DHbp/w568P8Md+//CnXv/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAApv4/8HbOH/lMf//3W3//9ytf//brL//w946v8SfvH/EHzw/w558P8AAAAAAAAAAAAAAAAAAAAAAAAAABF56f8Ndef/C3Dj/whs4f98u///eLn//3W3//+Evv//FoPx/xSA8f8SfvD/EHvw/wAAAAAAAAAAAAAAAA1EeF0WgOz/EXrp/w515v8LceT/lsn//3+9//97u///eLj//xaB7f8YhfL/FoLx/xSA8f8JP/deAAAAAAAAAAAgjfH/HIjw/xeB7P8Te+n/AAAAAAAAAACGwf//gr///369//+Iwf//HIny/xqH8v8YhfL/FYLx/wAAAAAnlfPlJJLy/yGO8v8cifD/GILt/wAAAAAAAAAAmMz//4nD//+Fwf//gb///xyJ8P8ejPP/HIny/xmH8v8XhPLnK5r0/yiW8/8lk/P/IpDy/wAAAAAAAAAAAAAAAAAAAACPx///jMX//4jD//+MxP//IpD0/yCO8/8di/P/G4ny/y6e9f8sm/T/KZj0/yaV8/8AAAAAAAAAAAAAAAAAAAAAlsz//5LJ//+Px///lMn//yaV9P8kkvT/IZD0/x+O8/8yo/blMKD1/y2d9f8qmfT/KJbz/wAAAAAAAAAAqdb//53Q//+Zzv//lsv//yiY8/8qmvX/KJf1/yWV9P8jkvTQAAAAADSl9v8xofX/Lp71/yyb9P8AAAAAAAAAAKfW//+k1P//oNL//6rW//8wofb/Lp72/yuc9f8pmfX/AAAAAAAAAAAcVHtcNab2/zKj9v8voPX/LZz0/7vh//+u2///qtj//6fW//8wofT/NKX3/zKj9/8voPb/F8/6XgAAAAAAAAAAAAAAADmr9/82qPf/M6T2/zCg9f+44f//td///7Hd//++4v//Oqz4/ziq+P81p/f/M6X3/wAAAAAAAAAAAAAAAAAAAAAAAAAAOqz4/zep9//M6///v+X//7vj//+44f//OKn1/z6x+f88rvn/Oaz4/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD6x+f8qmfP/yOv//8bq///C5///z+z//0O3+v9Ctfr/QLP5/z2x+f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA0u///8jr///I6///yOv//zmq9f9Dt/r/Q7f6/0O3+v8AAAAAAAAAAAAAAAAAAAAA8A8AAOAHAADgBwAAwAMAAMADAACGAQAABgAAAA8AAAAPAAAABgAAAIYBAADAAwAAwAMAAOAHAADgBwAA8A8AAA==" />\n\n    \x3c!--\n    ReDoc doesn't change outer page styles\n    --\x3e\n    <style>\n      body {\n        margin: 0;\n        padding: 0;\n      }\n    </style>\n    </head>\n    <body>\n    <redoc spec-url="${A=A.replace(/\/+(\/|$)/g,"$1")}"></redoc>\n    <script src="https://unpkg.com/redoc@2.0.0-rc.58/bundles/redoc.standalone.js"> <\/script>\n    </body>\n    </html>`}var p,l,f;!function(A){A.V1="v1"}(p||(p={})),function(A){A.NONE="none",A.OAUTH="oauth",A.SERVICE_HTTP="service_http",A.USER_HTTP="user_http"}(l||(l={})),function(A){A.OPENAPI="openapi"}(f||(f={}));class d extends e{_definitions=[];merge(A){for(const e of A._definitions)this._definitions.push({...e})}}function m(e){const n=new d,o=()=>{let A=t;"3"===e?.openapiVersion&&(A=r);return new A(n.definitions).generateDocument({openapi:"3"===e?.openapiVersion?"3.0.3":"3.1.0",info:{version:e?.schema?.info?.version||"1.0.0",title:e?.schema?.info?.title||"OpenAPI",...e?.schema?.info},...e?.schema})},a=A({base:e?.base,routes:e?.routes}),i=new Proxy(a,{get:(A,t,r,i)=>"original"===t?a:"schema"===t?o():"registry"===t?n:(o,...a)=>{if("handle"!==t)if(1===a.length&&a[0].registry){const A=a[0];n.merge(A.registry)}else if("all"!==t){const A=(e?.base||"")+o.replace(/\/+(\/|$)/g,"$1").replace(/:(\w+)/g,"{$1}");let r,i;for(const A of a)if(A.name&&(i=`${t.toString()}_${A.name}`),A.getSchemaZod){r=A.getSchemaZod();break}if(void 0===i&&(i=`${t.toString()}_${o.replaceAll("/","_")}`),void 0===r){r={operationId:i,responses:{200:{description:"Object with user data."}}};const A=o.match(/:(\w+)/g);A&&(r.request={params:s.object(A.reduce(((A,e)=>Object.assign(A,{[e]:s.string()})),{}))})}else if(!r.operationId){if(!1===e?.generateOperationIds&&!r.operationId)throw new Error(`Route ${o} don't have operationId set!`);r.operationId=i}n.registerPath({...r,method:t.toString(),path:A})}return Reflect.get(A,t,r)(o,...a.map((A=>A.handle?A.handle:A.isRoute?(...e)=>new A({}).execute(...e):A)))}});return null!==e?.docs_url&&null!==e?.openapi_url&&a.get(e?.docs_url||"/docs",(()=>new Response(c((e?.base||"")+(e?.openapi_url||"/openapi.json")),{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==e?.redoc_url&&null!==e?.openapi_url&&a.get(e?.redoc_url||"/redocs",(()=>new Response(u((e?.base||"")+(e?.openapi_url||"/openapi.json")),{headers:{"content-type":"text/html; charset=UTF-8"},status:200}))),null!==e?.openapi_url&&a.get(e?.openapi_url||"/openapi.json",(()=>new Response(JSON.stringify(o()),{headers:{"content-type":"application/json;charset=UTF-8"},status:200}))),e?.aiPlugin&&null!==e?.openapi_url&&a.get("/.well-known/ai-plugin.json",(A=>{const t={type:f.OPENAPI,has_user_authentication:!1,url:e?.openapi_url||"/openapi.json",...e?.aiPlugin?.api};return t.url.startsWith("http")||(t.url=`https://${A.headers.get("host")}${t.url}`),new Response(JSON.stringify({schema_version:p.V1,auth:{type:l.NONE},...e?.aiPlugin,api:t}),{headers:{"content-type":"application/json;charset=UTF-8"},status:200})})),i}function h(A){return void 0!==A._def}function g(A,e){return"ZodArray"===A._def.typeName||"ZodArray"===A._def.innerType?._def.typeName||"ZodArray"===A._def.schema?._def.innerType?._def.typeName}function y(A,e){if(e=e||{},null===A)return new j({required:!1,...e});if(h(A))return e?w(A,e):A;if(!0===A.generator)return new A(e);if(A===String)return new j(e);if("string"==typeof A)return new j({example:A});if(A===Number)return new P(e);if("number"==typeof A)return new P({example:A});if(A===Boolean)return new S(e);if("boolean"==typeof A)return new S({example:A});if(A===Date)return new q(e);if(Array.isArray(A)){if(0===A.length)throw new Error("Arr must have a type");return new v(A[0],e)}if("object"==typeof A)return new b(A,e);throw new Error(`${A} not implemented`)}function w(A,e){return!1===(e=e||{}).required&&(A=A.optional()),e.description&&(A=A.describe(e.description)),e.default&&(A=A.default(e.default)),e.example&&(A=A.openapi({example:e.example})),A}void 0===s.string().openapi&&n(s);class v{static generator=!0;constructor(A,e){return w(y(A).array(),e)}}class b{static generator=!0;constructor(A,e){const t={};for(const[e,r]of Object.entries(A))t[e]=y(r);return w(s.object(t),e)}}class P{static generator=!0;constructor(A){return w(s.number().or(s.string()).pipe(s.coerce.number()),A).openapi({type:"number"})}}class x{static generator=!0;constructor(A){return w(s.number().int().or(s.string()).pipe(s.coerce.number()),A).openapi({type:"integer"})}}class j{static generator=!0;constructor(A){return w(s.string(),A)}}class q{static generator=!0;constructor(A){return w(s.string().datetime({message:"Must be in the following format: YYYY-mm-ddTHH:MM:ssZ"}),A)}}class O{static generator=!0;constructor(A){return w(s.string().regex(A.pattern),A)}}class z{static generator=!0;constructor(A){return w(s.string().email(),A)}}class _{static generator=!0;constructor(A){return w(s.string().uuid(),A)}}class D{static generator=!0;constructor(A){return w(s.string().regex(/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/),A)}}class I{static generator=!0;constructor(A){return w(s.coerce.string().ip({version:"v4"}),A)}}class L{static generator=!0;constructor(A){return w(s.string().ip({version:"v6"}),A)}}class H{static generator=!0;constructor(A){return w(s.coerce.date(),A)}}class S{static generator=!0;constructor(A){return w(s.coerce.string().toLowerCase().pipe(s.enum(["true","false"]).transform((A=>"true"===A))),A).openapi({type:"boolean"})}}class B{static generator=!0;constructor(A){let{values:e}=A;const t={...e};Array.isArray(e)&&(e=Object.fromEntries(e.map((A=>[A,A]))));const r=Object.keys(e);!1===A.enumCaseSensitive&&(e=Object.keys(e).reduce(((A,t)=>(A[t.toLowerCase()]=e[t],A)),{}));const n=Object.keys(e);let o;o=[void 0,!0].includes(A.enumCaseSensitive)?s.enum(n):s.preprocess((A=>String(A).toLowerCase()),s.enum(n)).openapi({enum:r}),o=o.transform((A=>e[A]));const a=w(o,A);return a.values=t,a}}function E(A,e={}){return{name:e.name,location:"query",type:y(A,e)}}function M(A,e={}){return{name:e.name,location:"params",type:y(A,e)}}function C(A,e={}){return{name:e.name,location:"header",type:y(A,e)}}function T(A,e,t,r){if("query"===r)return e[t];if("path"===r)return A.params[t];if("header"===r)return A.headers.get(t);if("cookie"===r)throw new Error("Cookie parameters not implemented yet")}function k(A,e){const{searchParams:t}=new URL(A.url);if(0===t.size)return null;const r={};for(const[A,n]of t.entries())void 0===r[A]?r[A]=n:Array.isArray(r[A])?r[A].push(n):r[A]=[r[A],n],e&&e.shape[A]&&(g(e.shape[A])&&!Array.isArray(r[A])?r[A]=[r[A]]:g(e.shape[A]));return r}function Z(A,e){return new Response(JSON.stringify(A),{headers:{"content-type":"application/json;charset=UTF-8"},status:e?.status?e.status:200,...e})}class X{$customRequestBody=!0;content;constructor(A){this.content=A}}class K{handle(A,...e){throw new Error("Method not implemented.")}static isRoute=!0;static schema;params;constructor(A){this.params=A}static getSchema(){return this.schema}schema(){return this.__proto__.constructor.schema}getSchema(){return this.__proto__.constructor.getSchema()}getSchemaZod(){return this.__proto__.constructor.getSchemaZod()}static getSchemaZod(){const A={...this.getSchema()};let e={},t=A.requestBody;const r={},n={};t&&t.$customRequestBody?n.requestBody=t.content:t&&(h(t)||(t=y(t)),t={content:{"application/json":{schema:t}}},e.body=t),A.responses||(A.responses={200:{description:"Successfull response",schema:{}}});for(const[e,t]of Object.entries(A.responses)){let A=t.schema||{};h(A)||(A=y(A));const n=t.contentType||"application/json";r[e]={description:t.description,content:{[n]:{schema:A}}}}if(A.parameters){let t=A.parameters;const r={};Array.isArray(t)&&(t=t.reduce(((A,e)=>Object.assign(A,{[e.name]:e})),{}));for(const[A,e]of Object.entries(t))r[e.location]||(r[e.location]={}),r[e.location][A]=e.type;for(const[A,e]of Object.entries(r))r[A]=s.object(e);e={...e,...r}}return delete A.requestBody,delete A.parameters,delete A.responses,{...A,request:{...e},responses:r,...n}}handleValidationError(A){return Z({errors:A,success:!1,result:{}},{status:400})}async execute(...A){const{data:e,errors:t}=await this.validateRequest(A[0]);if(t)return this.handleValidationError(t);A.push(e);const r=await this.handle(...A);return r instanceof Response||"object"!=typeof r?r:Z(r)}extractQueryParameters(A,e){return k(A,e)}async validateRequest(A){const e=this.__proto__.constructor.getSchemaZod(),t={},r={};e.request?.params&&(r.params=e.request?.params,t.params=A.params),e.request?.query&&(r.query=e.request?.query,t.query={}),e.request?.headers&&(r.headers=e.request?.headers,t.headers={});const n=this.extractQueryParameters(A,e.request?.query);if(n&&(t.query=n),e.request?.headers){t.headers={};for(const r of Object.keys(e.request?.headers.shape))t.headers[r]=A.headers.get(r)}if("get"!==A.method.toLowerCase()&&e.request?.body&&e.request?.body.content["application/json"]&&e.request?.body.content["application/json"].schema){r.body=e.request.body.content["application/json"].schema;try{t.body=await A.json()}catch(A){t.body={}}}let o=s.object(r);void 0!==this.params?.raiseUnknownParameters&&!0!==this.params?.raiseUnknownParameters||(o=o.strict());const a=o.safeParse(t);return{data:a.success?a.data:void 0,errors:a.success?void 0:a.error.issues}}}export{f as APIType,o as ApiException,v as Arr,l as AuthType,S as Bool,H as DateOnly,q as DateTime,z as Email,B as Enumeration,C as Header,D as Hostname,i as InputValidationException,x as Int,I as Ipv4,L as Ipv6,P as Num,b as Obj,K as OpenAPIRoute,m as OpenAPIRouter,M as Path,E as Query,O as Regex,X as RequestBody,p as SchemaVersion,j as Str,_ as Uuid,a as ValidationError,w as convertParams,T as extractParameter,k as extractQueryParameters,u as getReDocUI,c as getSwaggerUI,Z as jsonResp};
